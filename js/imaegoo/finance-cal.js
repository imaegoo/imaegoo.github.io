function PMT(){}PMT.prototype.pmt=function(e,t,n,i,r){return i=i||0,r=r||0,0==e?-(n+i)/t:(n=e/((t=Math.pow(1+e,t))-1)*-(n*t+i),1==r&&(n/=1+e),n.toFixed(4))},PMT.prototype.nper=function(e,t,n,i,r){if(n=n||0,0==e)return-(t+n)/i;1===(r=r||0)&&(i*=1+e);r=Math.log((i-e*n)/(i+e*t))/Math.log(1+e);return Math.ceil(r)},PMT.prototype.pv=function(e,t,n,i,r){if(n=n||0,0===e)return-i*t-n;1===(r=r||0)&&(i*=1+e);r=Math.pow(1+e,t);return((-i*(r-1)/e-n)/r).toFixed(4)},PMT.prototype.fv=function(e,t,n,i,r){if(0===e)return-i*t-n;1===(r=r||0)&&(i*=1+e);r=Math.pow(1+e,t);return(-i*(r-1)/e-n*r).toFixed(4)};var query=function(e){return document.querySelector(e)},queryAll=function(e){return document.querySelectorAll(e)};function disableParam(){query('[name="param"]:not(:checked)').disabled=!0}function setInputFilter(t,n){["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop"].forEach(function(e){t.addEventListener(e,function(){n(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""})})}var pmtCalculator=new PMT,params=["nper","pv","fv","pmt"],todo=[];function calculate(){var e=queryAll('[name="param"]:checked');if(3===e.length){var t=query('[name="type"]:checked');if(t){var n=Number(query('[name="rate"]').value)/100,r=Number(t.value),l=[],a=[];let i=!1;if(e.forEach(function(e){var t=query(`[name="${e.value}"]`),n=(t.classList.remove("invalid-tip"),t.value),t=(""===n&&(i=!0,t.classList.add("invalid-tip")),query('[name="rate"]'));""===t.value&&(i=!0,t.classList.add("invalid-tip")),l.push(e.value),a.push(Number(n))}),!i)for(var u=0;u<params.length;u++){var o=params[u];if(-1===l.indexOf(params[u])){o=pmtCalculator[o](n,a[0],a[1],a[2],r);query(".result").innerHTML=o,query(".result").style.color="#333";break}}}}}function clearResult(){window.location.reload()}window.onload=function(){document.getElementById("calculate").addEventListener("click",calculate),document.getElementById("\bclear-result").addEventListener("click",clearResult);var n=queryAll("input.input-param"),i=queryAll("input[name=param]");for(let e=0,t=i.length;e<t;e++)i[e].addEventListener("click",function(){document.querySelector("input.input-param[name="+i[e].id+"]").classList.remove("invalid-tip")});for(let t=0,e=n.length;t<e;t++){let e=n[t];e.addEventListener("focus",function(){e.classList.remove("invalid-tip")}),e.nextElementSibling.addEventListener("click",function(){e.classList.remove("invalid-tip")})}Array.prototype.forEach.call(queryAll('[name="param"]'),function(e){e.addEventListener("click",function(e){var t=this.value,n=query(`[name="${t}"`);this.checked?(todo.push(t),n.disabled=!1,3===todo.length&&(query('[name="param"]:not(:checked)').disabled=!0)):(t=todo.indexOf(t),todo.splice(t,1),n.disabled=!0,n.value="",2===todo.length&&(query('[name="param"]:disabled').disabled=!1,query(".result").style.color="#9e9e9e"))})}),Array.prototype.forEach.call(queryAll(".input-param"),function(e){setInputFilter(e,function(e){return/^-?\d*\.?\d*$/.test(e)}),e.addEventListener("blur",function(){-1<[".","-","-."].indexOf(this.value)&&(this.value="")})});var t,r,l,a,u,o,c,s,d,p,v,f,m=document.querySelectorAll(".close");for(let e=0,t=m.length;e<t;e++){var y=m[e];y.removeEventListener("click",h),y.addEventListener("click",h)}function h(){window.parent.postMessage("close","*")}function b(e){t=null,r=e.currNum,a=e.prevBtn,o=u=null,c=0,l=e.history,d=!(s=!1)}function N(e){e=String(e),p.value=e}function q(e){v.value=e}function g(e){t=Number(new BigNumber(t).plus(e).toFixed(4))}function E(e){t=Number(new BigNumber(t).minus(e).toFixed(4))}function x(e){t=Number(new BigNumber(t).dividedBy(e).toFixed(4))}function k(e){t=Number(new BigNumber(t).times(e).toFixed(4))}v=document.querySelector("#history"),f=query(".sub-calc"),Array.prototype.forEach.call(queryAll(".mini-calc"),function(t){t.addEventListener("click",function(e){e.stopPropagation(),t.previousElementSibling.disabled||(b({currNum:(p=t.previousElementSibling).value,prevBtn:p.value,history:"0"===p.value?"":p.value}),f.style.display="inline-block",f.style.position="absolute",f.style.left=t.offsetLeft-f.offsetWidth+"px",f.style.top=t.offsetTop+20+"px",p.classList.add("focused"))})}),query(".pmt-calculator").addEventListener("click",function(e){f.style.display="none",Array.prototype.forEach.call(queryAll(".input-param"),function(e){e.classList.remove("focused")})}),query(".sub-calc").addEventListener("click",function(e){e.stopPropagation()}),Array.prototype.forEach.call(f.querySelectorAll(".button"),function(e){e.addEventListener("click",function(e){e=e.currentTarget.getAttribute("data-value");switch(isNaN(a)||"="===e||"C"===e||"CS"===e||"."===e||(o=u),e){case"+":s=!0,u=g;break;case"-":s=!0,u=E;break;case"/":s=!0,u=x;break;case"*":s=!0,u=k;break;case"C":b({currNum:"0",prevBtn:null,history:""}),N(0)}if(("C"===e||"Result is undefined"!==t)&&"Cannot divide by zero"!==t){if("="!==e&&"C"!==e&&"CS"!==e&&(l=isNaN(a)&&isNaN(e)?l.slice(0,-1)+e:l+e),isNaN(e)&&"."!==e){if("-"!==e&&"+"!==e&&"*"!==e&&"/"!==e||(null!==a&&"="!==a||d||(l="0"+e,c++),!v.value.length&&p.value.length&&(l=p.value+e)),u&&null===t&&(t=Number(r)),"%"===e?(l=l.slice(0,-(r.length+1)),r=(e=>Number(new BigNumber(e).dividedBy(100).toFixed(4)))(r),l+=r+" ",N(r)):"sqrt"!==e&&"1/x"!==e&&"+/-"!==e||(l=l.slice(0,-(r.length+e.length))+("1/x"===e?"1/("+r+") ":"+/-"===e?"-1*("+r+") ":e+"("+r+") "),N(r="sqrt"===e?(e=>Number(new BigNumber(e).sqrt().toFixed(4)))(p.value):"1/x"===e?(e=>Number(new BigNumber(1).dividedBy(e).toFixed(4)))(p.value):-1*p.value),q(l)),"="===e&&u)return void(c=0,u(s?r:Number(r)),l="",a=e,N(t),q(l));if(!isNaN(e)||isNaN(a)&&"%"!==a&&"sqrt"!==a&&"1/x"!==a||"="===e||"C"===e||"CS"===e||"."===e||"%"===e||"sqrt"===e||"1/x"===e||c++,2<=c&&(!isNaN(a)||"sqrt"===a||"sqr"===a||"1/x"===a||"%"===a)&&"CS"!==e&&(o(Number(r)),l=(r=t)+e,c=1,N(t)),"CS"===e){if(t==p.value||-1!==["sqrt","%","1/x","+/-"].indexOf(a))return;r=r.slice(0,-1),l=l.slice(0,-1),N(r=r.length?r:"0")}null!==t&&"CS"!==e&&q(l)}else"."===e&&/^\d+$/.test(r)?r+=e:isNaN(e)||("="===a&&(t=null),r=!isNaN(a)&&null!==a&&"0"!==p.value||"."===a?r+e:e),s=!1,N(r);a=e,d=!1}})})};