((e,o)=>{"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof module&&module.exports?module.exports=o(require("jquery")):o(e.jQuery)})(this,function(u){function e(e){return this.core=u(e).data("lightGallery"),this.core.s=u.extend({},a,this.core.s),this.core.s.zoom&&this.core.doCss()&&(this.init(),this.zoomabletimeout=!1,this.pageX=u(window).width()/2,this.pageY=u(window).height()/2+u(window).scrollTop()),this}var o,t,a;a={scale:1,zoom:!0,actualSize:!0,enableZoomAfter:300,useLeftForZoom:(o=!1,t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),o=!!(t&&parseInt(t[2],10)<54)||o)},e.prototype.init=function(){function a(e,o,t,a){var r=o.prop("offsetWidth"),t=i.core.s.dynamic?i.core.s.dynamicEl[t].width||o[0].naturalWidth||r:i.core.$items.eq(t).attr("data-width")||o[0].naturalWidth||r;i.core.$outer.hasClass("lg-zoomed")?s=1:r<t&&(s=t/r||2),a?(i.pageX=u(window).width()/2,i.pageY=u(window).height()/2+u(window).scrollTop()):(i.pageX=e.pageX||e.originalEvent.targetTouches[0].pageX,i.pageY=e.pageY||e.originalEvent.targetTouches[0].pageY),n(),setTimeout(function(){i.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")},10)}var i=this,e='<button type="button" aria-label="Zoom in" id="lg-zoom-in" class="lg-icon"></button><button type="button" aria-label="Zoom out" id="lg-zoom-out" class="lg-icon"></button>',s=(i.core.s.actualSize&&(e+='<button type="button" aria-label="Actual size" id="lg-actual-size" class="lg-icon"></button>'),i.core.s.useLeftForZoom?i.core.$outer.addClass("lg-use-left-for-zoom"):i.core.$outer.addClass("lg-use-transition-for-zoom"),this.core.$outer.find(".lg-toolbar").append(e),i.core.$el.on("onSlideItemLoad.lg.tm.zoom",function(e,o,t){var a=i.core.s.enableZoomAfter+t;u("body").hasClass("lg-from-hash")&&t?a=0:u("body").removeClass("lg-from-hash"),i.zoomabletimeout=setTimeout(function(){i.core.$slide.eq(o).addClass("lg-zoomable")},a+30)}),1),o=function(e){var o=i.core.$outer.find(".lg-current .lg-image"),t=(u(window).width()-o.prop("offsetWidth"))/2,a=(u(window).height()-o.prop("offsetHeight"))/2+u(window).scrollTop(),t=(e-1)*(i.pageX-t),a=(e-1)*(i.pageY-a);o.css("transform","scale3d("+e+", "+e+", 1)").attr("data-scale",e),(i.core.s.useLeftForZoom?o.parent().css({left:-t+"px",top:-a+"px"}):o.parent().css("transform","translate3d(-"+t+"px, -"+a+"px, 0)")).attr("data-x",t).attr("data-y",a)},n=function(){1<s?i.core.$outer.addClass("lg-zoomed"):i.resetZoom(),o(s=s<1?1:s)},r=!1;i.core.$el.on("onAferAppendSlide.lg.tm.zoom",function(e,o){var t=i.core.$slide.eq(o).find(".lg-image");t.on("dblclick",function(e){a(e,t,o)}),t.on("touchstart",function(e){r?(clearTimeout(r),r=null,a(e,t,o)):r=setTimeout(function(){r=null},300),e.preventDefault()})}),u(window).on("resize.lg.zoom scroll.lg.zoom orientationchange.lg.zoom",function(){i.pageX=u(window).width()/2,i.pageY=u(window).height()/2+u(window).scrollTop(),o(s)}),u("#lg-zoom-out").on("click.lg",function(){i.core.$outer.find(".lg-current .lg-image").length&&(s-=i.core.s.scale,n())}),u("#lg-zoom-in").on("click.lg",function(){i.core.$outer.find(".lg-current .lg-image").length&&(s+=i.core.s.scale,n())}),u("#lg-actual-size").on("click.lg",function(e){a(e,i.core.$slide.eq(i.core.index).find(".lg-image"),i.core.index,!0)}),i.core.$el.on("onBeforeSlide.lg.tm",function(){s=1,i.resetZoom()}),i.zoomDrag(),i.zoomSwipe()},e.prototype.getCurrentTransform=function(e){return e&&"none"!==(e=(e=window.getComputedStyle(e,null)).getPropertyValue("-webkit-transform")||e.getPropertyValue("-moz-transform")||e.getPropertyValue("-ms-transform")||e.getPropertyValue("-o-transform")||e.getPropertyValue("transform")||"none")?e.split("(")[1].split(")")[0].split(","):0},e.prototype.getCurrentRotation=function(e){return(e=e&&this.getCurrentTransform(e))?Math.round(Math.atan2(e[1],e[0])*(180/Math.PI)):0},e.prototype.getModifier=function(e,o,t){var a,r=e,t=(e=Math.abs(e),this.getCurrentTransform(t));return t?(a=1,"X"===o?(o=Math.sign(parseFloat(t[0])),0===e||180===e?a=1:90===e&&(a=-90===r&&1===o||90===r&&-1===o?-1:1),a*=o):(o=Math.sign(parseFloat(t[3])),0===e||180===e?a=1:90===e&&(e=parseFloat(t[1]),t=parseFloat(t[2]),a=Math.sign(e*t*r*o)),a*=o),a):1},e.prototype.getImageSize=function(e,o,t){return e.prop({y:"offsetHeight",x:"offsetWidth"}[t=90===o?"x"===t?"y":"x":t])},e.prototype.getDragCords=function(e,o){return 90===o?{x:e.pageY,y:e.pageX}:{x:e.pageX,y:e.pageY}},e.prototype.getSwipeCords=function(e,o){var t=e.originalEvent.targetTouches[0].pageX,e=e.originalEvent.targetTouches[0].pageY;return 90===o?{x:e,y:t}:{x:t,y:e}},e.prototype.getPossibleDragCords=function(e,o){var t=(this.core.$outer.find(".lg").height()-this.getImageSize(e,o,"y"))/2,a=Math.abs(this.getImageSize(e,o,"y")*Math.abs(e.attr("data-scale"))-this.core.$outer.find(".lg").height()+t),r=(this.core.$outer.find(".lg").width()-this.getImageSize(e,o,"x"))/2,e=Math.abs(this.getImageSize(e,o,"x")*Math.abs(e.attr("data-scale"))-this.core.$outer.find(".lg").width()+r);return 90===o?{minY:r,maxY:e,minX:t,maxX:a}:{minY:t,maxY:a,minX:r,maxX:e}},e.prototype.getDragAllowedAxises=function(e,o){var t=this.getImageSize(e,o,"y")*e.attr("data-scale")>this.core.$outer.find(".lg").height(),e=this.getImageSize(e,o,"x")*e.attr("data-scale")>this.core.$outer.find(".lg").width();return 90===o?{allowX:t,allowY:e}:{allowX:e,allowY:t}},e.prototype.resetZoom=function(){this.core.$outer.removeClass("lg-zoomed"),this.core.$slide.find(".lg-img-wrap").removeAttr("style data-x data-y"),this.core.$slide.find(".lg-image").removeAttr("style data-scale"),this.pageX=u(window).width()/2,this.pageY=u(window).height()/2+u(window).scrollTop()},e.prototype.zoomSwipe=function(){var a,r=this,i={},s={},n=!1,l=!1,g=!1,d=0;r.core.$slide.on("touchstart.lg",function(e){var o;r.core.$outer.hasClass("lg-zoomed")&&(o=r.core.$slide.eq(r.core.index).find(".lg-object"),a=r.core.$slide.eq(r.core.index).find(".lg-img-rotate")[0],d=r.getCurrentRotation(a),o=r.getDragAllowedAxises(o,Math.abs(d)),g=o.allowY,(l=o.allowX)||g)&&(e.preventDefault(),i=r.getSwipeCords(e,Math.abs(d)))}),r.core.$slide.on("touchmove.lg",function(e){var o,t;r.core.$outer.hasClass("lg-zoomed")&&(t=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),e.preventDefault(),n=!0,s=r.getSwipeCords(e,Math.abs(d)),r.core.$outer.addClass("lg-zoom-dragging"),e=g?-Math.abs(t.attr("data-y"))+(s.y-i.y)*r.getModifier(d,"Y",a):-Math.abs(t.attr("data-y")),o=l?-Math.abs(t.attr("data-x"))+(s.x-i.x)*r.getModifier(d,"X",a):-Math.abs(t.attr("data-x")),15<Math.abs(s.x-i.x)||15<Math.abs(s.y-i.y))&&(r.core.s.useLeftForZoom?t.css({left:o+"px",top:e+"px"}):t.css("transform","translate3d("+o+"px, "+e+"px, 0)"))}),r.core.$slide.on("touchend.lg",function(){r.core.$outer.hasClass("lg-zoomed")&&n&&(n=!1,r.core.$outer.removeClass("lg-zoom-dragging"),r.touchendZoom(i,s,l,g,d))})},e.prototype.zoomDrag=function(){var a,r=this,i={},s={},n=!1,l=!1,g=!1,d=!1,c=0;r.core.$slide.on("mousedown.lg.zoom",function(e){a=r.core.$slide.eq(r.core.index).find(".lg-img-rotate")[0],c=r.getCurrentRotation(a);var o=r.core.$slide.eq(r.core.index).find(".lg-object"),o=r.getDragAllowedAxises(o,Math.abs(c));d=o.allowY,g=o.allowX,r.core.$outer.hasClass("lg-zoomed")&&u(e.target).hasClass("lg-object")&&(g||d)&&(e.preventDefault(),i=r.getDragCords(e,Math.abs(c)),n=!0,r.core.$outer.scrollLeft+=1,--r.core.$outer.scrollLeft,r.core.$outer.removeClass("lg-grab").addClass("lg-grabbing"))}),u(window).on("mousemove.lg.zoom",function(e){var o,t;n&&(t=r.core.$slide.eq(r.core.index).find(".lg-img-wrap"),l=!0,s=r.getDragCords(e,Math.abs(c)),r.core.$outer.addClass("lg-zoom-dragging"),e=d?-Math.abs(t.attr("data-y"))+(s.y-i.y)*r.getModifier(c,"Y",a):-Math.abs(t.attr("data-y")),o=g?-Math.abs(t.attr("data-x"))+(s.x-i.x)*r.getModifier(c,"X",a):-Math.abs(t.attr("data-x")),r.core.s.useLeftForZoom?t.css({left:o+"px",top:e+"px"}):t.css("transform","translate3d("+o+"px, "+e+"px, 0)"))}),u(window).on("mouseup.lg.zoom",function(e){n&&(n=!1,r.core.$outer.removeClass("lg-zoom-dragging"),!l||i.x===s.x&&i.y===s.y||(s=r.getDragCords(e,Math.abs(c)),r.touchendZoom(i,s,g,d,c)),l=!1),r.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")})},e.prototype.touchendZoom=function(e,o,t,a,r){var i=this,s=i.core.$slide.eq(i.core.index).find(".lg-img-wrap"),n=i.core.$slide.eq(i.core.index).find(".lg-object"),l=i.core.$slide.eq(i.core.index).find(".lg-img-rotate")[0],g=-Math.abs(s.attr("data-x"))+(o.x-e.x)*i.getModifier(r,"X",l),l=-Math.abs(s.attr("data-y"))+(o.y-e.y)*i.getModifier(r,"Y",l),n=i.getPossibleDragCords(n,Math.abs(r));(15<Math.abs(o.x-e.x)||15<Math.abs(o.y-e.y))&&(a&&(l<=-n.maxY?l=-n.maxY:l>=-n.minY&&(l=-n.minY)),t&&(g<=-n.maxX?g=-n.maxX:g>=-n.minX&&(g=-n.minX)),a?s.attr("data-y",Math.abs(l)):l=-Math.abs(s.attr("data-y")),t?s.attr("data-x",Math.abs(g)):g=-Math.abs(s.attr("data-x")),i.core.s.useLeftForZoom?s.css({left:g+"px",top:l+"px"}):s.css("transform","translate3d("+g+"px, "+l+"px, 0)"))},e.prototype.destroy=function(){var e=this;e.core.$el.off(".lg.zoom"),u(window).off(".lg.zoom"),e.core.$slide.off(".lg.zoom"),e.core.$el.off(".lg.tm.zoom"),e.resetZoom(),clearTimeout(e.zoomabletimeout),e.zoomabletimeout=!1},u.fn.lightGallery.modules.zoom=e});